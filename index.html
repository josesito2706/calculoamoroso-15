<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Nuestro Amor â€” Calculadora RomÃ¡ntica</title>
<style>
  /* ===== Paleta Lila Pastel ===== */
  :root{
    --lila-1:#f5f0ff;
    --lila-2:#efe6ff;
    --lila-3:#dcc7ff;
    --lila-4:#b691ff;
    --lila-5:#7a5cff;
    --ink:#2a2438;
    --paper:#fbf8ff;

    /* Teclado: MORADO MUY VISIBLE */
    --heart1:#5b00ff;      /* base fuerte */
    --heart2:#be4bff;      /* luz */
    --heartHover1:#7b1fff; /* hover */
    --heartHover2:#f05dff; /* hover luz */
    --heartOutline:#2b007a;/* borde */
  }
  *{box-sizing:border-box}
  body{
    margin:0; min-height:100svh; color:var(--ink);
    font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial;
    background:
      radial-gradient(1200px 800px at 20% -10%, #efe6ff 0%, transparent 60%),
      radial-gradient(1000px 600px at 100% 0%, #f2eaff 0%, transparent 60%),
      linear-gradient(180deg, var(--lila-1), var(--lila-2));
  }
  .hidden{display:none !important}
  .fade-in{animation:fade .6s ease both} @keyframes fade{from{opacity:0; transform:translateY(6px)}}

  /* ===== Intro con efecto ===== */
  .intro{
    min-height:100svh; position:relative; overflow:hidden;
    display:grid; place-items:center; padding:24px;
  }
  .intro .btn{
    font-size:18px; padding:18px 26px;
    animation:pulse 2.2s ease-in-out infinite;
  }
  @keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.04)}}
  .floaters{position:absolute; inset:0; pointer-events:none; overflow:hidden}
  .floater{position:absolute; font-size:26px; opacity:.18; animation:fly 12s linear infinite}
  .floater:nth-child(odd){animation-duration:14s; opacity:.22}
  @keyframes fly{0%{transform:translateY(110vh)}100%{transform:translateY(-10vh)}}

  /* ===== BotÃ³n base ===== */
  .btn{
    appearance:none; border:0; cursor:pointer; border-radius:999px;
    font-weight:700; color:#fff; background:linear-gradient(135deg, var(--lila-5), var(--lila-4));
    box-shadow:0 10px 18px #7a5cff44, inset 0 -2px 0 #00000022;
    transition:.12s transform,.2s filter;
  }
  .btn:hover{transform:translateY(-1px)} .btn:active{transform:translateY(1px) scale(.98)}
  .btn.small{padding:10px 14px; font-size:14px}

  /* ===== App (card) ===== */
  .wrap { display:grid; place-items:center; padding:24px; }
  .card{
    width:min(980px,100%); background:#ffffffcc; backdrop-filter:blur(8px);
    border:1px solid #ffffffaa; border-radius:24px;
    box-shadow:0 10px 30px #7a5cff22,0 2px 12px #00000014; overflow:hidden;
  }
  header{padding:24px 24px 8px; text-align:center;}
  header h1{margin:0; font-weight:800; font-size:clamp(22px,4vw,34px); color:var(--lila-5)}
  header p{margin:6px 0 0; color:#6b6b7a}

  /* ===== Barra de mÃºsica ===== */
  .music{
    display:flex; align-items:center; gap:12px;
    margin:10px 20px 0; padding:10px 12px;
    background:#fff; border:1px solid var(--lila-3); border-radius:14px;
  }
  .music label{font-weight:700; color:#5e4ea3}
  .music .file{color:#4b3e6b; font-weight:600}
  .music input[type="range"]{width:140px}
  .music .note{font-size:12px; color:#8274b8; margin-left:auto}

  .panel{display:grid; gap:18px; grid-template-columns:1fr; padding:10px 20px 24px}
  .box{
    background:#fff; border:1px solid var(--lila-3);
    border-radius:20px; padding:18px; box-shadow:0 6px 16px #7a5cff1a
  }
  .box h3{margin:0 0 10px; color:var(--lila-5); font-size:18px}

  .fields{display:grid; gap:12px}
  .field{display:flex; flex-direction:column; gap:6px}
  .field label{font-size:14px; color:#5e4ea3; font-weight:700}
  .field input{
    padding:12px 14px; border-radius:14px; border:1px solid #d8caff;
    font-size:16px; outline:none; background:#fbf9ff;
  }
  .field input[readonly]{
    background:#f7f3ff; color:#524a6b;
    cursor:not-allowed; user-select:none;
  }
  .hint{font-size:12px;color:#888}
  .badge{
    display:inline-flex; align-items:center; gap:6px; font-size:12px; font-weight:700; color:#5e4ea3;
    background:#efe6ff; border:1px dashed #d1c2ff; padding:6px 10px; border-radius:999px; margin-top:6px
  }

  /* ===== Calculadora â€” morado fuerte + hover ===== */
  .calc{display:grid; grid-template-columns:repeat(3,1fr); gap:12px; margin-top:10px}
  .heart{
    position:relative; height:64px; border:none; cursor:pointer; background:lavenderblush;
    filter:drop-shadow(0 10px 16px #2b007a55); transition:.12s transform
  }
  .heart:active{transform:scale(.96)}
  .heart .shape{
    width:100%; height:100%;
    background:
      radial-gradient(40% 40% at 30% 30%, #ffffffee 0 42%, transparent 43%) top left/50% 50% no-repeat,
      radial-gradient(40% 40% at 70% 30%, #ffffffee 0 42%, transparent 43%) top right/50% 50% no-repeat,
      linear-gradient(145deg, var(--heart1), var(--heart2));
    -webkit-clip-path:path("M27 9 C27 3, 21 0, 17 3 C13 0, 7 3, 7 9 C7 15, 14 19, 17 24 C20 19, 27 15, 27 9 Z");
            clip-path:path("M27 9 C27 3, 21 0, 17 3 C13 0, 7 3, 7 9 C7 15, 14 19, 17 24 C20 19, 27 15, 27 9 Z");
    border-radius:16px; box-shadow:inset 0 -10px 14px #0000003b, 0 2px 2px #ffffffaa;
    outline:2px solid var(--heartOutline);
    transition:filter .15s ease, transform .15s ease, outline-color .2s ease, background .2s ease;
  }
  .heart:hover .shape{
    filter:brightness(1.08) saturate(1.25) drop-shadow(0 8px 12px #7a5cff66);
    background:
      radial-gradient(40% 40% at 30% 30%, #ffffff 0 42%, transparent 43%) top left/50% 50% no-repeat,
      radial-gradient(40% 40% at 70% 30%, #ffffff 0 42%, transparent 43%) top right/50% 50% no-repeat,
      linear-gradient(145deg, var(--heartHover1), var(--heartHover2));
    outline-color:#3c16d2;
  }
  .heart:focus-visible .shape{outline-width:3px; outline-color:#1b0a83}
  .heart span{
    position:absolute; inset:0; display:grid; place-items:center; font-weight:900;
    color:#030202; text-shadow:0 2px 4px #000000aa; font-size:19px; letter-spacing:.3px
  }
  .calc-row{grid-column:1/-1; display:grid; grid-template-columns:repeat(3,1fr); gap:12px}
  .wide{grid-column:span 2} .ghost{opacity:1}

  /* ===== Modal resultado ===== */
  .modal{
    position:fixed; inset:0; background:rgba(74,56,157,.28);
    backdrop-filter:blur(6px); display:grid; place-items:center; z-index:1000;
  }
  .dialog{
    width:min(900px, 92vw); background:#fff; border:1px solid var(--lila-3);
    border-radius:18px; box-shadow:0 20px 40px #0000002a; padding:18px 18px 16px; position:relative;
  }
  .close{
    position:absolute; top:10px; right:10px; border:0; background:#f0eaff; color:#513cc7;
    width:36px; height:36px; border-radius:999px; font-size:20px; font-weight:800; cursor:pointer;
    box-shadow:0 4px 10px #7a5cff33;
  }
  .dialog h2{margin:0 0 12px; text-align:center; color:#4e3cb4}
  .photos{
    margin:8px auto 10px; display:flex; gap:14px; justify-content:center; flex-wrap:wrap
  }
  /* Mostrar las imÃ¡genes COMPLETAS */
  .photo{
    max-width:min(420px, 45vw); height:auto; border-radius:16px; border:3px solid #e5dbff;
    display:block; background:#f9f7ff; object-fit:contain; /* sin recortes */
  }
  .tagline{margin:10px auto 0; text-align:center; font-weight:800; color:#5e4ea3}
  .scroll{position:relative; margin:12px auto 6px; max-width:760px; background:var(--paper);
    border:1px solid #e0d3ff; padding:16px 14px; border-radius:12px; box-shadow:inset 0 0 0 2px #fff3, 0 10px 16px #00000012}
  .scroll:before,.scroll:after{content:""; position:absolute; left:12px; right:12px; height:10px;
    background:radial-gradient(12px 10px at 0 50%, #cbb8ff 60%, transparent 61%) left/20px 100% no-repeat,
              radial-gradient(12px 10px at 100% 50%, #cbb8ff 60%, transparent 61%) right/20px 100% no-repeat,
              linear-gradient(#cbb8ff,#cbb8ff); top:-8px; border-radius:8px}
  .scroll:after{top:auto; bottom:-8px}
  .scroll p{margin:0; font-family:"Noto Serif KR","Noto Serif",serif; font-size:18px; line-height:1.55; color:#4b3e6b; text-align:center}

  footer{text-align:center; padding:0 0 18px; font-size:12px; color:#8274b8}
  .ok{outline:2px solid #8be28b} .bad{outline:2px solid #ff6b6b}
</style>
</head>
<body>

  <!-- ===== Intro ===== -->
  <section id="intro" class="intro">
    <div class="floaters" aria-hidden="true">
      <span class="floater" style="left:10%; animation-delay:-2s">ğŸ’œ</span>
      <span class="floater" style="left:25%; animation-delay:-7s">ğŸ’œ</span>
      <span class="floater" style="left:40%; animation-delay:-4s">ğŸ’œ</span>
      <span class="floater" style="left:55%; animation-delay:-9s">ğŸ’œ</span>
      <span class="floater" style="left:70%; animation-delay:-5s">ğŸ’œ</span>
      <span class="floater" style="left:85%; animation-delay:-11s">ğŸ’œ</span>
    </div>
    <button id="startBtn" class="btn">Â¿Lista para calcular nuestro amor?</button>
  </section>

  <!-- ===== App ===== -->
  <div id="app" class="wrap hidden">
    <div class="card">
      <header>
        <h1>ğŸ’œ Nuestra pequeÃ±a calculadora del amor</h1>
        <p>Porque cada dÃ­a cuentaâ€¦ y late.</p>
      </header>

      <!-- ğŸµ Barra de mÃºsica -->
      <section class="music" aria-label="MÃºsica de fondo">
        <label>ğŸµ MÃºsica:</label>
        <span class="file">beso.mp3</span>
        <button id="playToggle" class="btn small" type="button">â–¶ Reproducir</button>
        <input id="vol" type="range" min="0" max="1" step="0.01" value="0.4" aria-label="Volumen">
        <span class="note">Se reproduce en bucle suave</span>
        <audio id="loveAudio" src="beso.mp3" preload="auto" loop></audio>
      </section>

      <section class="panel">
        <div class="box">
          <h3>Ingresa las fechas</h3>
          <div class="fields">
            <div class="field">
              <label for="start">Nuestra fecha (DD/MM/AAAA)</label>
              <input id="start" inputmode="numeric" placeholder="00/00/0000" autocomplete="off" />
              <div id="realBadge" class="badge hidden">ğŸ’˜ Â¡Esa es nuestra fecha real!</div>
            </div>
            <div class="field">
              <label for="today">Fecha de hoy (DD/MM/AAAA)</label>
              <input id="today" inputmode="numeric" placeholder="00/00/0000" autocomplete="off" readonly aria-readonly="true" title="Se autocompleta con el corazÃ³n ="/>
              <div class="hint">Se puede autocompletar con el corazÃ³n â€œ=â€.</div>
            </div>
          </div>

          <div class="calc hidden" id="calcPad" aria-label="Calculadora de corazones">
            <!-- fila 1 -->
            <button class="heart" data-val="7"><div class="shape"></div><span>7</span></button>
            <button class="heart" data-val="8"><div class="shape"></div><span>8</span></button>
            <button class="heart" data-val="9"><div class="shape"></div><span>9</span></button>
            <!-- fila 2 -->
            <button class="heart" data-val="4"><div class="shape"></div><span>4</span></button>
            <button class="heart" data-val="5"><div class="shape"></div><span>5</span></button>
            <button class="heart" data-val="6"><div class="shape"></div><span>6</span></button>
            <!-- fila 3 -->
            <button class="heart" data-val="1"><div class="shape"></div><span>1</span></button>
            <button class="heart" data-val="2"><div class="shape"></div><span>2</span></button>
            <button class="heart" data-val="3"><div class="shape"></div><span>3</span></button>
            <!-- fila 4 -->
            <button class="heart" data-val="/"><div class="shape"></div><span>/</span></button>
            <button class="heart" data-val="0"><div class="shape"></div><span>0</span></button>
            <button class="heart" id="back"><div class="shape"></div><span>âŒ«</span></button>
            <!-- fila 5 -->
            <div class="calc-row">
              <button class="heart wide ghost" id="clear"><div class="shape"></div><span>Limpiar</span></button>
              <button class="heart" id="fillToday"><div class="shape"></div><span>=</span></button>
            </div>
            <!-- fila 6 -->
            <div class="calc-row">
              <button class="heart wide" id="calc"><div class="shape"></div><span>ğŸ’œ Calcular</span></button>
            </div>
          </div>
        </div>
      </section>

      <footer>Hecho con â™¥ para ti preciosa&lt;3</footer>
    </div>
  </div>

  <!-- ===== Modal (resultado) ===== -->
  <div id="modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="dialog fade-in">
      <button class="close" id="closeModal" aria-label="Cerrar">Ã—</button>
      <h2 id="modalTitle">Resultado</h2>
      <div class="photos" id="modalPhotos"></div>
      <p class="tagline">Hasta el infinito y mÃ¡s allÃ¡ ğŸ’œ</p>
      <div class="scroll"><p id="koreanText"></p></div>
    </div>
  </div>

<script>
(function(){
  const intro = document.getElementById('intro');
  const startBtn = document.getElementById('startBtn');
  const app = document.getElementById('app');

  const calcPad = document.getElementById('calcPad');
  const inputs = { start: document.getElementById('start'), today: document.getElementById('today') };
  const badge = document.getElementById('realBadge');

  // MÃºsica
  const audio = document.getElementById('loveAudio');
  const playToggle = document.getElementById('playToggle');
  const vol = document.getElementById('vol');

  // Modal
  const modal = document.getElementById('modal');
  const closeModalBtn = document.getElementById('closeModal');
  const modalTitle = document.getElementById('modalTitle');
  const modalPhotos = document.getElementById('modalPhotos');
  const koreanText = document.getElementById('koreanText');

  // Intro -> App
  startBtn.addEventListener('click', async () => {
    intro.classList.add('hidden');
    app.classList.remove('hidden');
    calcPad.classList.remove('hidden');
    inputs.today.value = formatDate(new Date());
    inputs.start.focus();

    // intentar reproducir beso.mp3 suave
    try{
      audio.volume = parseFloat(vol.value || "0.4");
      await audio.play();
      playToggle.textContent = "â¸ Pausar";
    }catch(e){
      // si el navegador bloquea el autoplay, el usuario puede pulsar Reproducir
      playToggle.textContent = "â–¶ Reproducir";
    }
  });

  // Controles mÃºsica
  playToggle.addEventListener('click', async ()=>{
    if(audio.paused){
      try{
        await audio.play();
        playToggle.textContent = "â¸ Pausar";
      }catch(e){}
    }else{
      audio.pause();
      playToggle.textContent = "â–¶ Reproducir";
    }
  });
  vol.addEventListener('input', ()=>{ audio.volume = parseFloat(vol.value || "0.4"); });

  // Estado de foco para el â€œtecladoâ€ de corazones
  let activeInput = inputs.start;
  [inputs.start, inputs.today].forEach(el=>{
    el.addEventListener('focus', ()=> activeInput = el);
    el.addEventListener('input', onTyping);
  });

  // Teclado (evitar editar 'today' con corazones)
  document.querySelectorAll('.heart[data-val]').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(activeInput === inputs.today) return; // bloquea ediciÃ³n del campo de hoy
      const v = btn.getAttribute('data-val');
      insertVal(v);
    });
  });
  document.getElementById('back').addEventListener('click', ()=>{
    if(activeInput === inputs.today) return; // no borrar en 'hoy'
    activeInput.value = activeInput.value.slice(0, -1);
    onTyping();
  });

  // Limpiar SOLO nuestra fecha
  document.getElementById('clear').addEventListener('click', ()=>{
    inputs.start.value = "";
    badge.classList.add('hidden');
    inputs.start.classList.remove('ok','bad');
    inputs.start.focus();
  });

  // Autocompletar hoy
  document.getElementById('fillToday').addEventListener('click', ()=>{
    inputs.today.value = formatDate(new Date());
    onTyping(); activeInput = inputs.start; inputs.start.focus();
  });

  document.getElementById('calc').addEventListener('click', calculate);

  // Modal helpers
  function openModal(){ modal.classList.remove('hidden'); document.body.style.overflow='hidden'; }
  function closeModal(){ modal.classList.add('hidden'); document.body.style.overflow=''; }
  closeModalBtn.addEventListener('click', closeModal);
  modal.addEventListener('click', (e)=>{ if(e.target === modal) closeModal(); });
  window.addEventListener('keydown', (e)=>{ if(e.key==='Escape' && !modal.classList.contains('hidden')) closeModal(); });

  function insertVal(v){
    if(v === "/"){ activeInput.value += "/"; }
    else{
      activeInput.value += v;
      const clean = activeInput.value.replace(/[^\d]/g,'');
      if(clean.length === 2 || clean.length === 4){
        activeInput.value = clean.replace(/^(\d{2})(\d{0,2})?(\d{0,4})?/, (m,d,mm,yy)=> {
          return mm ? `${d}/${mm}${yy?'/'+yy:''}` : d;
        });
      }
    }
    onTyping();
  }

  function onTyping(){
    const val = inputs.start.value.trim();
    if(normalize(val) === "15/11/2023"){ badge.classList.remove('hidden'); }
    else { badge.classList.add('hidden'); }
    paintValidity(inputs.start); paintValidity(inputs.today);
  }

  function paintValidity(el){
    const ok = parseDMY(el.value);
    el.classList.remove('ok','bad');
    if(el.value.length){ el.classList.add(ok ? 'ok' : 'bad'); }
  }

  // Utilidades de fecha
  function normalize(s){return s.replace(/\s+/g,'').replace(/-/g,'/')}
  function parseDMY(s){
    if(!s) return null;
    const m = normalize(s).match(/^(\d{2})\/(\d{2})\/(\d{4})$/);
    if(!m) return null;
    const [_, dd, mm, yyyy] = m.map(x=>x);
    const d = Number(dd), mth = Number(mm)-1, y = Number(yyyy);
    const date = new Date(y, mth, d);
    if(date.getFullYear()!==y || date.getMonth()!==mth || date.getDate()!==d) return null;
    return date;
  }
  function formatDate(d){
    const dd = String(d.getDate()).padStart(2,'0');
    const mm = String(d.getMonth()+1).padStart(2,'0');
    const yyyy = d.getFullYear();
    return `${dd}/${mm}/${yyyy}`;
  }
  function diffYMD(start, end){
    if(end < start) [start, end] = [end, start];
    let y = end.getFullYear() - start.getFullYear();
    let m = end.getMonth() - start.getMonth();
    let temp = new Date(start.getFullYear()+y, start.getMonth()+m, start.getDate());
    if (temp > end){ m -= 1; temp = new Date(start.getFullYear()+y, start.getMonth()+m, start.getDate()); }
    if (m < 0){ y -= 1; m += 12; }
    const msPerDay = 24*60*60*1000;
    const d = Math.floor((end - temp)/msPerDay);
    return {years:y, months:m, days:d};
  }
  function prettyYMD(y,m,d){
    const parts = [];
    if(y>0) parts.push(`${y} aÃ±o${y!==1?'s':''}`);
    if(m>0) parts.push(`${m} mes${m!==1?'es':''}`);
    if(d>0 || (y===0 && m===0)) parts.push(`${d} dÃ­a${d!==1?'s':''}`);
    return parts.join(", ");
  }

  function calculate(){
    const d1 = parseDMY(inputs.start.value);
    const d2 = parseDMY(inputs.today.value);
    if(!d1 || !d2){
      alert("Revisa el formato de ambas fechas (DD/MM/AAAA). Ej.: 15/11/2023");
      return;
    }
    const {years, months, days} = diffYMD(d1, d2);
    const pretty = prettyYMD(years, months, days);

    const title = (normalize(inputs.start.value)==="15/11/2023")
      ? `Desde nuestro dÃ­a (15/11/2023) hasta hoy van ${pretty}.`
      : `Desde ${inputs.start.value} hasta ${inputs.today.value} van ${pretty}.`;

    // Llenar modal
    modalTitle.textContent = `ğŸ’œ ${title}`;
    modalPhotos.innerHTML = `
      <img class="photo" src="osito.png" alt="[osito.png]">
      <img class="photo" src="pandita.png" alt="[pandita.png]">
    `;
    const korean = `ì‚¬ë‘í•˜ëŠ” ë„ˆì™€ í•¨ê»˜í•œ ë§¤ì¼ì´ ê¸°ì ì´ì•¼. 
ìš°ë¦¬ëŠ” ì„œë¡œì˜ ë³„ì´ ë˜ì–´ ì–´ëŠ ë°¤ì—ë„ ê¸¸ì„ ë¹„ì¶œ ê±°ì•¼. 
ì˜¤ëŠ˜ë„, ë‚´ì¼ë„, ì˜ì›íˆ ì‚¬ë‘í•´. # 15`;
    koreanText.innerHTML = korean.replace(/\n/g,"<br>");

    openModal();
  }

  // Enter = calcular (solo en "nuestra fecha")
  inputs.start.addEventListener('keydown',(e)=>{
    if(e.key==='Enter'){ e.preventDefault(); calculate(); }
  });
})();
</script>
</body>
</html>
